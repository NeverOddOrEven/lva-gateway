{
    "@apiVersion": "1.0",
    "name": "RtspCameraTrigger",
    "properties": {
        "description": "Record on signal",
        "sources": [
            {
                "@type": "#Microsoft.Media.MediaGraphRtspSource",
                "name": "###RtspCameraId",
                "endpoint": {
                    "@type": "#Microsoft.Media.MediaGraphClearEndpoint",
                    "url": "###RtspUrl",
                    "credentials": {
                        "@type": "#Microsoft.Media.MediaGraphUsernamePasswordCredentials",
                        "username": "###RtspAuthName",
                        "password": "###RtspAuthPassword"
                    }
                }
            },
            {
                "@type": "#Microsoft.Media.MediaGraphIoTHubMessageSource",
                "name": "iotMessageSource",
                "hubInputName": "lvaTrigger"
            }
        ],
        "processors": [
            {
                "@type": "#Microsoft.Media.MediaGraphSignalGateProcessor",
                "name": "signalGateProcessor",
                "inputs": [
                    {
                        "moduleName": "iotMessageSource"
                    },
                    {
                        "moduleName": "###RtspCameraId"
                    }
                ],
                "activationEvaluationWindow": "PT1S",
                "activationSignalOffset": "PT0S",
                "minimumActivationTime": "PT5S",
                "maximumActivationTime": "PT5S"
            }
        ],
        "sinks": [
            {
                "@type": "#Microsoft.Media.MediaGraphFileSink",
                "name": "filesink",
                "inputs": [
                    {
                        "moduleName": "signalGateProcessor"
                    }
                ],
                "filePathPattern": "/var/media/###CameraId-${System.DateTime}.mp4"
            }
        ]
    }
}